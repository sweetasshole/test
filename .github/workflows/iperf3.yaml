name: TCP iperf3 Test
on: [push]

jobs:
  tcp-test:
    runs-on: ubuntu-latest
    steps:
      - name: Install iperf3
        run: |
          sudo apt update
          sudo apt install -y iperf3

      - name: Test TCP connectivity
        run: |
          SERVERS=(
            "51.158.154.173 5201"
            "51.158.154.173 5200"
            "94.23.122.180 5002"
            "185.24.184.11 5240"
            "51.68.48.148 9240"
          )

          for s in "${SERVERS[@]}"; do
            ip=$(echo $s | awk '{print $1}')
            port=$(echo $s | awk '{print $2}')
            echo "==== Testing TCP $ip:$port ===="
            timeout 10 iperf3 -c "$ip" -p "$port" || echo "FAILED"
            echo
          done
